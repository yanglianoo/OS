# Onix vscode 调试配置解析

`launch.json`设置官方文档：[Configure launch.json for C/C++ debugging in Visual Studio Code](https://code.visualstudio.com/docs/cpp/launch-json-reference)

`tasks.json`设置官方文档：[Tasks in Visual Studio Code](https://code.visualstudio.com/Docs/editor/tasks)

> `launch.json`文件是VSCode**启动程序**的配置文件，`task.json`就是用于定义前置任务。若在`launch.json`中指定了`preLaunchTask`参数，则会去执行`task.json`中指定的命令。如果是直接调试可执行文件，不需要配置`task.json`，如果是调试源文件，需要配置`task.json`。

## 常用变量替换

- `${workspaceFolder}`：项目文件夹在 VS Code 中打开的路径
- `${file}`：当前开打开（激活）的文件
- `${relativeFile}`：相对于 `{workspaceFolder}` 的文件路径
- `${fileBasename}`：当前打开文件的名称
- `${fileBasenameNoExtension}`：当前打开文件的名称，不带扩展名的
- `${fileExtname}`：当前打开文件的扩展名
- `${fileDirname}`：当前打开文件的文件夹名称

## launch.json 配置

```json
    {
    "version": "0.2.0",
    "configurations": [
        {
            "name": "onix - Build and debug kernel",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/build/kernel.bin",
            "args": [],
            "stopAtEntry": false,
            "cwd": "${workspaceFolder}/src",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerServerAddress": "localhost:1234",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ],
            "miDebuggerPath": "/usr/bin/gdb"
        },
    ]
}
```
 - `version`:版本号，无需修改

 - `configurations`:配置信息，为一个数组类型
    - `name`：调试任务的名称
    
    - `type`：调试环境的具体类型 node、java、cppdbg 等等
    
    - `request`: 调试模式，一共有两种模式
    
      > `launch`：和应用一起启动
      > `attach`：应用已经启动了，但是又想在不重新启动的情况下调试该应用，就可以把调试器附加到应用上
    
    - `program`: 启动文件的路径
    
    - `args`：程序启动时传递的参数
    
    - `stopAtEntry`：自动断点到第一行代码处
    
    - `cwd` 指定程序启动调试的目录 ,当vscode启动目录不是项目根目录时非常有用
    
    - `environment`：要添加到程序环境中的环境变量
    
    - `externalConsole`：仅在启动调试对象时使用。对于`attach`模式，此参数不会更改调试对象的行为。用来设置调试控制台的参数
    
      > - **Windows**: When set to true, it will spawn an external console. When set to false, it will use VS Code's integratedTerminal.
      > - **Linux**: When set to true, it will notify VS Code to spawn an external console. When set to false, it will use VS Code's integratedTerminal.
      > - **macOS**: When set to true, it will spawn an external console through . When set to false, the output can be seen in VS Code's debugConsole. Due to limitations within , integratedTerminal support is not available.`lldb-mi``lldb-mi`
    
    - `MIMode`：指定调试器名字，`gdb`或者`lldb`
    
    - `miDebuggerServerAddress`：用于远程调试的调试器服务器
    
    - `setupCommands`：设置GDB或LLDB所需执行的命令的JSON数组。(好像不用设置也没啥影响)
    
    - `miDebuggerPath`：调试器可执行文件的路径

## task.json

```json
{
    "tasks": [
        {
            "type": "shell",
            "label": "C/C++: gcc build active file",
            "command": "/usr/bin/gcc",
            "args": [
                "-fdiagnostics-color=always",
                "-m32", // 32 位的程序
                "-g",
                "-I${workspaceFolder}/src/include",
                "${file}",
                "-o",
                "${fileDirname}/${fileBasenameNoExtension}.out"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "detail": "Task generated by Debugger."
        },
    ],
    "version": "2.0.0"
}
```

> - **label**: The task's label used in the user interface.
> - **type**: The task's type. For a custom task, this can either be `shell` or `process`. If `shell` is specified, the command is interpreted as a shell command (for example: bash, cmd, or PowerShell). If `process` is specified, the command is interpreted as a process to execute.
> - **command**: The actual command to execute.
> - **windows**: Any Windows specific properties. Will be used instead of the default properties when the command is executed on the Windows operating system.
> - **group**: Defines to which group the task belongs. In the example, it belongs to the `test` group. Tasks that belong to the test group can be executed by running **Run Test Task** from the **Command Palette**.
> - **presentation**: Defines how the task output is handled in the user interface. In this example, the Integrated Terminal showing the output is `always` revealed and a `new` terminal is created on every task run.
> - **options**: Override the defaults for `cwd` (current working directory), `env` (environment variables), or `shell` (default shell). Options can be set per task but also globally or per platform. Environment variables configured here can only be referenced from within your task script or process and will not be resolved if they are part of your args, command, or other task attributes.
> - **runOptions**: Defines when and how a task is run.